package LockerManagement;

import java.awt.Color;

import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.border.TitledBorder;
import javax.swing.JTextField;
import javax.swing.JButton;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.awt.Font;
import javax.swing.GroupLayout;
import javax.swing.GroupLayout.Alignment;
import javax.swing.ImageIcon;
import javax.swing.JFormattedTextField;
import javax.swing.JOptionPane;
import javax.swing.JPasswordField;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.beans.Statement;
import java.sql.Connection;
import java.sql.Date;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.text.SimpleDateFormat;
import java.awt.Frame;
import java.awt.Window.Type;
import java.awt.Point;
import java.awt.Cursor;

public class logIn extends JFrame {
	private JTextField branchCodeText;
	private JPasswordField passwordText;
	private JPasswordField userNameText;
	public static String currentDate;
	public logIn() {
		setLocation(new Point(500, 200));
		getContentPane().setBackground(new Color(0, 153, 102));
		setTitle("Login");
		
		JPanel logInPanel = new JPanel();
		logInPanel.setBounds(146, 135, 202, 93);
		logInPanel.setBackground(new Color(0, 153, 102));
		logInPanel.setBorder(new TitledBorder(null, "Log In", TitledBorder.LEADING, TitledBorder.TOP, null, null));
		logInPanel.setLayout(null);
		
		branchCodeText = new JTextField();
		branchCodeText.setBounds(10, 21, 55, 20);
		logInPanel.add(branchCodeText);
		branchCodeText.setColumns(10);
        
		JButton signInButton = new JButton("Sign In");
		signInButton.setEnabled(true);
		signInButton.addMouseListener(new MouseAdapter() {
			@Override
			public void mouseClicked(MouseEvent arg0) {
				
				
				
//				String branchCode = branchCodeText.getText();
//				String userName = userNameText.getText();
//				String password = passwordText.getText();
				
				String branchCode = "1000";
				String userName = "Wajahat";
				String password = "abc123";

				
				if((!branchCode.isEmpty() || !userName.isEmpty() || !password.isEmpty()) && branchCode.length()==4){
					
				
				

				try {
					Class.forName("COM.ibm.db2.jdbc.app.DB2Driver");
					java.sql.Connection connection = null;
					java.sql.Statement  lcl_stmt =null;
					connection = java.sql.DriverManager.getConnection("jdbc:db2:WA27389", "db2admin", "admin123/?");
				
					PreparedStatement statement = connection.prepareStatement("SELECT * FROM LOGIN WHERE BRN_CD=? AND USER_NAME=? AND PASSWORD=?");

					statement.setString(1, branchCode);
					statement.setString(2, userName);
					statement.setString(3, password);
					
					ResultSet result = statement.executeQuery();

					if (result.next()) {
						JOptionPane.showMessageDialog(null,"Signin Successful");
						System.out.println(result.getString("ACTIVITY"));
						if(result.getString("ACTIVITY").equals("AUTH")){
							
							mainMenuAuthorization obj = new mainMenuAuthorization(1);
						
							obj.setVisible(true);
							obj.setSize(600, 500);
					    	
							dispose();
						}
						else if (result.getString("ACTIVITY").equals("USER")) {
							mainMenuAuthorization obj = new mainMenuAuthorization(0);
							obj.setVisible(true);
							obj.setSize(600, 500);
							dispose();
						}

						else
						{
							JOptionPane.showMessageDialog(null,"Not Authorized");
						}

						}
					else
						{
							JOptionPane.showMessageDialog(null,"Invalid Credentials");
						}
				
				} catch (Exception e) {
					System.out.println(e.getMessage());
					// TODO: handle exception
					System.out.println("DB Connection fail");
					JOptionPane.showMessageDialog(null,"DB Connection Failed");
				}
				}
			}
		});
		signInButton.setBounds(146, 239, 79, 23);
		
		JButton exitButton = new JButton("Exit");
		exitButton.setBounds(280, 239, 79, 23);
		exitButton.addActionListener(new ActionListener() {
			
			public void actionPerformed(ActionEvent arg0) {
				System.exit(404);
			}
		});
		
		JLabel lblUserVerification = new JLabel("User Verification");
		lblUserVerification.setBounds(278, 77, 187, 39);
		lblUserVerification.setFont(new Font("Tahoma", Font.BOLD, 15));
		getContentPane().setLayout(null);
		getContentPane().add(logInPanel);
		
		passwordText = new JPasswordField();
		passwordText.setCursor(Cursor.getPredefinedCursor(Cursor.TEXT_CURSOR));
		passwordText.setBounds(20, 62, 165, 20);
		logInPanel.add(passwordText);
		
		userNameText = new JPasswordField();
		userNameText.setBounds(72, 21, 103, 20);
		logInPanel.add(userNameText);
		getContentPane().add(signInButton);
		getContentPane().add(exitButton);
		getContentPane().add(lblUserVerification);
	}

//    private static void createAndShowGUI() {
//
//    }

    public static void main(String[] args) {
    	logIn frame = new logIn();
    	frame.setSize(600, 500);
    	frame.setVisible(true);
    }
}
