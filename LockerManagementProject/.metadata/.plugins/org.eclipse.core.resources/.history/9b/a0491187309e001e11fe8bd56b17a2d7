package LockerManagement;

import javax.swing.JFrame;
import java.awt.Color;
import java.awt.Dimension;

import javax.swing.JTable;
import javax.swing.JLabel;
import java.awt.Font;
import javax.swing.JButton;
import javax.swing.JList;
import javax.swing.JComboBox;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JOptionPane;
import javax.swing.JScrollPane;
import javax.swing.JTextPane;
import javax.swing.JTextField;
import javax.swing.table.DefaultTableModel;

import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.awt.Point;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import javax.swing.JPanel;
import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;

public class lockerIssuance extends JFrame {
	private JTable smallLockerTable;
	private JTextField accountNumberText;
	String [] columnNames={"Locker Available", "Lockers Size"};
	Object[][] data= new Object[3][2];
	
	public lockerIssuance()
	{
		JPanel panel= new JPanel();
		panel.setBounds(24,23,403,262);
		getContentPane().add(panel);
		panel.setLayout(null);
		smallLockerTable=new JTable(data,columnNames);
		smallLockerTable.setBounds(10,25,674,174);
		getContentPane().add(smallLockerTable);
		JScrollPane scroll=new JScrollPane(smallLockerTable);
		scroll.setBounds(0,0,403,262);
		panel.add(scroll);
		try {
			Class.forName("COM.ibm.db2.jdbc.app.DB2Driver");
			java.sql.Connection connection = null;
			java.sql.Statement  lcl_stmt =null;
			connection = java.sql.DriverManager.getConnection("jdbc:db2:WA27389", "db2admin", "admin123/?");
						
			String query="select count(*) as Available, lockersizeid from locker where lockernum not in(select lockernum from lockerassigned_tr union select lockernum from lockerassigned_tl order by lockernum) group by lockersizeid;";
			PreparedStatement statement = connection.prepareStatement(query);
			
//			statement.setString(1, branchCode);
//			statement.setString(2, userName);
//			statement.setString(3, password);
			
			ResultSet result = statement.executeQuery();
			System.out.println(result);
			
			
			ArrayList<Object[]> rows= new ArrayList<>();
			while(result.next()) {
				Object[] row= new Object[2];
				for ( int i=0;i<2;i++){
					
					row[i]=result.getString(i+1);
					System.out.println(i+" "+row[i]);
				}
				if(row[1].equals("1")){
					row[1]="Small";
				}
				else if (row[1].equals("2")){
					row[1]="Medium";
				}
				else if (row[1].equals("3")){
					row[1]="Large";
				}
				rows.add(row);
			}
			
			
			for (int i=0; i<rows.size();i++){
				data[i]=rows.get(i);
			}
		} catch (Exception e) {
			System.out.println(e.getMessage());
			// TODO: handle exception
			System.out.println("DB Connection fail");
//			JOptionPane.showMessageDialog(null,"DB Connection Failed");
		}
		
		setLocation(new Point(500, 200));
		setTitle("Locker Issuance");
		getContentPane().setBackground(new Color(0, 153, 102));
		getContentPane().setLayout(null);
		
		JLabel lblLockersInformation = new JLabel("Lockers Information");
		lblLockersInformation.setFont(new Font("Tahoma", Font.PLAIN, 15));
		lblLockersInformation.setBounds(142, 29, 139, 30);
		getContentPane().add(lblLockersInformation);
		
		JButton signOffButton = new JButton("Sign Off");
		signOffButton.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				logIn obj=new logIn();
				obj.setVisible(true);
				obj.setSize(600, 400);
				dispose();
			}
		});
		signOffButton.setBounds(10, 421, 89, 23);
		getContentPane().add(signOffButton);
		
		JButton backButton = new JButton("Back");
		backButton.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				lockerModule obj = new lockerModule();
				obj.setVisible(true);
				obj.setSize(600, 500);
				dispose();
			}
		});
		backButton.setBounds(466, 421, 89, 23);
		getContentPane().add(backButton);
		
		JComboBox identificationComboBox = new JComboBox();
		identificationComboBox.setModel(new DefaultComboBoxModel(new String[] {"Account Number"}));
		identificationComboBox.setSelectedIndex(-1);
		identificationComboBox.setMaximumRowCount(3);
		identificationComboBox.setToolTipText("");
		identificationComboBox.setBounds(91, 320, 153, 30);
		getContentPane().add(identificationComboBox);
		
		JLabel lblLockerSize = new JLabel("Identification Type");
		lblLockerSize.setBounds(93, 289, 94, 20);
		getContentPane().add(lblLockerSize);
		
		JLabel lblAccountNumber = new JLabel("Account Number");
		lblAccountNumber.setBounds(313, 289, 139, 21);
		getContentPane().add(lblAccountNumber);
		
		accountNumberText = new JTextField();
		accountNumberText.addFocusListener(new FocusAdapter() {
			@Override
			public void focusLost(FocusEvent arg0) {
				try{
					String accNum=accountNumberText.getText();
					Class.forName("COM.ibm.db2.jdbc.app.DB2Driver");
					java.sql.Connection connection = null;
					java.sql.Statement  lcl_stmt =null;
					connection = java.sql.DriverManager.getConnection("jdbc:db2:WA27389", "db2admin", "admin123/?");
								
					String query="select accountstatus.accountstatusid,accountstatus.accountstatus from accountnew,accountstatus where accountnew.accountstatusid=accountstatus.accountstatusid and accountnew.accountnum='1234567891245689';";
					PreparedStatement statement = connection.prepareStatement(query);
					
//					statement.setString(1, accNum);
//					statement.setString(2, userName);
//					statement.setString(3, password);
					
					ResultSet result = statement.executeQuery();
					
					if (result.next()) { // move the cursor to the next row
					    String accountStatus = result.getString("accountstatus");
					    Integer id = result.getInt("accountstatusid");// get the accountstatus column value
					    System.out.println("Account id: " + id);
					    if (id==1){
					  
					    	 JOptionPane.showMessageDialog(null,"Authorized For Locker");
					    }
					    else{
					     	 JOptionPane.showMessageDialog(null,"Not Authorized For Locker");
					    }
					   
					}
				}
				catch(Exception e){
					System.out.println("Error");
					System.out.println(e.getMessage());
				}
			}
		});
		accountNumberText.setBounds(313, 321, 153, 30);
		getContentPane().add(accountNumberText);
		accountNumberText.setColumns(10);
		
		
		
		JButton proceedButton = new JButton("Proceed");
		proceedButton.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				customerDetails obj= new customerDetails(0);
				obj.setVisible(true);
				obj.setSize(600,500);
				dispose();
			}
		});
		proceedButton.setBounds(122, 421, 89, 23);
		getContentPane().add(proceedButton);
		
		
	}
	 public static void main(String[] args) {
		 lockerIssuance frame = new lockerIssuance();
	    	frame.setSize(600, 500);
	    	frame.setVisible(true);
	    }
}
